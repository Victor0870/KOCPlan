<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Game Trắc Nghiệm</title>
  <script src="https://download.playfab.com/PlayFabClientApi.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; max-width: 600px; margin: auto; }
    #quiz, #loading { display: none; }
    .answer { display: block; margin: 10px 0; padding: 10px; background: #fff; border: 1px solid #ccc; border-radius: 6px; }
    .answer:hover { background: #e0e0e0; }
    input, button { padding: 10px; margin-top: 10px; width: 100%; box-sizing: border-box; }
    button { background: #007bff; color: white; border: none; border-radius: 5px; }
  </style>
</head>
<body>
  <div id="home">
    <h2>Game Trắc Nghiệm</h2>
    <input id="playerName" placeholder="Tên người chơi">
    <input id="playerCode" placeholder="Mã code 3 số" maxlength="3">
    <button onclick="login()">Bắt đầu</button>
  </div>

  <div id="loading">Đang tải câu hỏi...</div>

  <div id="quiz">
    <div id="questionText"></div>
    <div id="answerList"></div>
    <button id="nextButton" onclick="nextQuestion()">Next</button>
  </div>

  <script>
    PlayFab.settings.titleId = "13875";

    let quizData = [];
    let currentIndex = 0;

    function login() {
      const name = document.getElementById("playerName").value.trim();
      const code = document.getElementById("playerCode").value.trim();
      if (name === "" || code.length !== 3 || isNaN(code)) {
        alert("Nhập tên và mã 3 số!");
        return;
      }

      const customId = `${name}_${code}`;
      PlayFabClientSDK.LoginWithCustomID({
        CustomId: customId,
        CreateAccount: true
      }, function () {
        document.getElementById("home").style.display = "none";
        document.getElementById("loading").style.display = "block";
        loadQuiz();
      }, function (err) {
        alert("Lỗi đăng nhập PlayFab");
        console.error(err);
      });
    }

    function loadQuiz() {
      PlayFabClientSDK.GetTitleData({ Keys: ["quiz"] }, function (result) {
        if (!result.Data.quiz) {
          alert("Không có dữ liệu quiz trong TitleData!");
          return;
        }
        quizData = JSON.parse(result.Data.quiz);
        currentIndex = 0;
        document.getElementById("loading").style.display = "none";
        document.getElementById("quiz").style.display = "block";
        showQuestion();
      }, function (error) {
        alert("Không thể tải câu hỏi");
        console.error(error);
      });
    }

    function showQuestion() {
      const questionObj = quizData[currentIndex];
      document.getElementById("questionText").innerText = "Câu " + (currentIndex + 1) + ": " + questionObj.question;

      const answerList = document.getElementById("answerList");
      answerList.innerHTML = "";
      questionObj.answers.forEach((ans, idx) => {
        const btn = document.createElement("button");
        btn.className = "answer";
        btn.innerText = ans;
        btn.onclick = () => {
          btn.style.backgroundColor = idx === questionObj.correct ? "lightgreen" : "salmon";
        };
        answerList.appendChild(btn);
      });

      document.getElementById("nextButton").innerText = currentIndex < quizData.length - 1 ? "Next" : "Kết thúc";
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex < quizData.length) {
        showQuestion();
      } else {
        alert("Bạn đã hoàn thành bài trắc nghiệm!");
        document.getElementById("quiz").style.display = "none";
        document.getElementById("home").style.display = "block";
      }
    }
  </script>
</body>
</html>
